<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manage Rooms - Hallmate</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
body { background:#f8f9fa; padding:2rem; font-family: Inter, system-ui; }
.card { border-radius:12px; box-shadow:0 8px 24px rgba(16,24,40,0.06); }
</style>
</head>
<body>

<div class="container mt-5">
    <h1 class="mb-4">Manage Rooms</h1>

    <!-- Add Room Form -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">Add Room</div>
        <div class="card-body">
            <form id="addRoomForm">
                <div class="row g-3">
                    <div class="col-md-3"><input type="text" id="room_no" class="form-control" placeholder="Room No" required></div>
                    <div class="col-md-3"><input type="number" id="capacity" class="form-control" placeholder="Capacity" required></div>
                    <div class="col-md-4"><input type="text" id="location" class="form-control" placeholder="Location"></div>
                    <div class="col-md-2"><button type="submit" class="btn btn-success w-100">Add Room</button></div>
                </div>
            </form>
        </div>
    </div>

    <!-- Room List -->
    <div class="card">
        <div class="card-header bg-secondary text-white">Room List</div>
        <div class="card-body">
            <table class="table table-bordered" id="roomsTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Room No</th>
                        <th>Capacity</th>
                        <th>Location</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>

<script>
function loadRooms() {
    $.get("../backend/rooms.php", function(data) {
        if (data.success) {
            let rows = '';
            data.rooms.forEach(r => {
                rows += `<tr>
                    <td>${r.id}</td>
                    <td>${r.room_no}</td>
                    <td>${r.capacity}</td>
                    <td>${r.location || ''}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="editRoom(${r.id}, '${r.room_no}', ${r.capacity}, '${r.location || ''}')">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteRoom(${r.id})">Delete</button>
                    </td>
                </tr>`;
            });
            $("#roomsTable tbody").html(rows);
        } else {
            alert("Failed to load rooms: " + data.message);
        }
    }, "json");
}

$("#addRoomForm").submit(function(e) {
    e.preventDefault();
    $.ajax({
        url: "../backend/rooms.php",
        method: "POST",
        contentType: "application/json",
        data: JSON.stringify({
            room_no: $("#room_no").val(),
            capacity: parseInt($("#capacity").val()),
            location: $("#location").val()
        }),
        success: function(res) {
            if (res.success) {
                loadRooms();
                $("#addRoomForm")[0].reset();
            } else {
                alert(res.message || "Error adding room");
            }
        }
    });
});

function editRoom(id, room_no, capacity, location) {
    let newRoomNo = prompt("Edit Room No:", room_no);
    let newCapacity = prompt("Edit Capacity:", capacity);
    let newLocation = prompt("Edit Location:", location);

    if (newRoomNo !== null && newCapacity !== null) {
        $.ajax({
            url: "../backend/rooms.php",
            method: "PUT",
            contentType: "application/json",
            data: JSON.stringify({
                id: id,
                room_no: newRoomNo,
                capacity: parseInt(newCapacity),
                location: newLocation
            }),
            success: function(res) {
                if (res.success) loadRooms();
                else alert(res.message || "Error updating room");
            }
        });
    }
}

function deleteRoom(id) {
    if (confirm("Are you sure you want to delete this room?")) {
        $.ajax({
            url: "../backend/rooms.php",
            method: "DELETE",
            contentType: "application/json",
            data: JSON.stringify({ id: id }),
            success: function(res) {
                if (res.success) loadRooms();
                else alert(res.message || "Error deleting room");
            }
        });
    }
}

// Initial load
loadRooms();
</script>

</body>
</html>
