<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Manage Exams - Hallmate</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<style>
body { background:#f8fafc; font-family: Inter, system-ui; padding:2rem;}
.card { border-radius:12px; box-shadow:0 8px 24px rgba(16,24,40,0.06); }
</style>
</head>
<body>
<div class="container mt-5">
    <h1 class="mb-4">Manage Exams</h1>

    <!-- Add Exam Form -->
    <div class="card mb-4 p-3">
        <h5>Add Exam</h5>
        <form id="addExamForm" class="row g-3">
            <div class="col-md-3"><input type="text" id="subject" class="form-control" placeholder="Subject" required></div>
            <div class="col-md-2"><input type="text" id="course_code" class="form-control" placeholder="Course Code" required></div>
            <div class="col-md-2"><input type="text" id="batch" class="form-control" placeholder="Batch" required></div>
            <div class="col-md-2"><input type="date" id="exam_date" class="form-control" required></div>
            <div class="col-md-2">
                <select id="session" class="form-control" required>
                    <option value="">Select Session</option>
                    <option value="Morning">Morning</option>
                    <option value="Afternoon">Afternoon</option>
                </select>
            </div>
            <div class="col-md-1"><input type="number" id="expected_students" class="form-control" placeholder="Expected" min="1"></div>
            <div class="col-12"><button type="submit" class="btn btn-success mt-2">Add Exam</button></div>
        </form>
    </div>

    <!-- Exam List -->
    <div class="card p-3">
        <h5>Exam List</h5>
        <table class="table table-bordered" id="examsTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Subject</th>
                    <th>Course Code</th>
                    <th>Batch</th>
                    <th>Date</th>
                    <th>Session</th>
                    <th>Expected Students</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script>
function loadExams() {
    $.get("../backend/exams.php", function(data){
        if(data.success){
            let rows = '';
            data.exams.forEach(e=>{
                rows+=`<tr>
                    <td>${e.id}</td>
                    <td>${e.subject}</td>
                    <td>${e.course_code}</td>
                    <td>${e.batch}</td>
                    <td>${e.exam_date}</td>
                    <td>${e.session}</td>
                    <td>${e.expected_students}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="editExam(${e.id},'${e.subject}','${e.course_code}','${e.batch}','${e.exam_date}','${e.session}',${e.expected_students})">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteExam(${e.id})">Delete</button>
                    </td>
                </tr>`;
            });
            $("#examsTable tbody").html(rows);
        }else alert("Failed to load exams");
    },"json");
}

$("#addExamForm").submit(function(e){
    e.preventDefault();
    $.ajax({
        url:"../backend/exams.php",
        method:"POST",
        contentType:"application/json",
        data:JSON.stringify({
            subject: $("#subject").val(),
            course_code: $("#course_code").val(),
            batch: $("#batch").val(),
            exam_date: $("#exam_date").val(),
            session: $("#session").val(),
            expected_students: parseInt($("#expected_students").val()) || 0
        }),
        success:function(res){
            if(res.success){ loadExams(); $("#addExamForm")[0].reset(); }
            else alert(res.error || "Error adding exam");
        }
    });
});

function editExam(id, subject, course_code, batch, exam_date, session, expected_students){
    let newSub = prompt("Edit Subject", subject);
    if(newSub !== null){
        $.ajax({
            url:"../backend/exams.php",
            method:"PUT",
            contentType:"application/json",
            data:JSON.stringify({id:id, subject:newSub, course_code, batch, exam_date, session, expected_students}),
            success:function(res){ if(res.success) loadExams(); else alert(res.error); }
        });
    }
}

function deleteExam(id){
    if(confirm("Delete this exam?")){
        $.ajax({
            url:"../backend/exams.php",
            method:"DELETE",
            contentType:"application/json",
            data:JSON.stringify({id:id}),
            success:function(res){ if(res.success) loadExams(); else alert(res.error); }
        });
    }
}

$(document).ready(function(){ loadExams(); });
</script>

</body>
</html>
